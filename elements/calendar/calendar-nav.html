<link rel="import" href="../../scenes/base-scene.html">
<link rel="import" href="../../components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../components/core-animated-pages/transitions/cross-fade.html">

<!--
Village calendar navigation.

@element calendar-nav
@extends base-scene
-->
<polymer-element name="calendar-nav" extends="base-scene">
  <template>
    <link rel="stylesheet" href="calendar-nav.css" no-shim>
    <style>
      paper-tabs::shadow #selectionBar {
        background-color: #fede32;
      }
      paper-tab::shadow #ink {
        color: rgba(254, 222, 50, 0.5);
      }
    </style>

    <div id="module-nav">

      <div id="global-nav" class="{{ {opened: opened, opening: opening, closing: closing, closed: closed, scrollable: scrollable} | tokenList}}">
        <a id="global-nav-btn" href="#village{{!active ? '/calendar' : ''}}" layout horizontal>
          <div class="nav-santa-icon"></div>
          <div class="nav-santa-bar"></div>
        </a>
        <div id="sound">
          <a href="#" class="on"><i></i></a>
        </div>
        <div id="global-nav-body">
          <div id="global-nav-header" layout horizontal center-center>
            <a id="global-back-to-village" href="{{baseURI}}#village" title="Go to the Village" class="back">Go to the Village</a>
            <paper-tabs id="tabs" valueattr="filterOn" selected="{{filterOn}}">
              <paper-tab filterOn="watch">Videos</paper-tab>
              <paper-tab filterOn="play">Games</paper-tab>
              <paper-tab filterOn="calendar">The Calendar</paper-tab>
              <paper-tab filterOn="learn">Education</paper-tab>
              <paper-tab filterOn="scene">Scenes</paper-tab>
            </paper-tabs>
          </div>

          <div id="global-nav-content">

            <core-animated-pages transitions="cross-fade" selected="{{route}}" valueattr="route">
              <section route="village/calendar">
                <div id="nav-calendar" cross-fade class="{{filterOn}}">
                  <div layout horizontal wrap>
                    <div class="card"></div>

                    <div layout vertical center-center data-index="1"
                         class="card calendar scene video play learn">
                      <template repeat="{{house, i in firstFour}}">
                        <a href="{{baseURI}}#{{house.module}}">
                          <div class="menu-marker calendar {{house.category}}" style="background-image:url({{componentURL}}img/village-menu-icons-1-{{house.module}}.svg);"></div>
                        </a>
                      </template>
                    </div>

                    <template repeat="{{house, i in regularSchedule}}">
                      <div layout vertical center-center data-index="{{i + 2}}" data-category="{{house.category}}" class="card calendar {{house.category}} {{ {iced: house.iced, melt: !house.iced} | tokenList }}">
                        <a href="{{baseURI}}#{{house.module}}">
                          <div class="menu-marker marker{{i + 2}} calendar {{house.category}}" style="background-image:url({{componentURL}}img/village-menu-icons-{{i + 2}}-{{house.module}}.svg);"></div>
                        </a>
                      </div>
                    </template>
                    <div class="card"></div>
                    <div class="card"></div>
                    <div class="card"></div>
                  </div>
                </div>
              </section>
              <section route="village/onthego">
                <div id="nav-onthego" cross-fade>
                  <div class="onthego-item onthego-android">
                    <a href="//play.google.com/store/apps/details?id=com.google.android.apps.santatracker">
                      <div class="logo"></div>
                      <h2>Play</h2>
                      <p>Play with friends in the Santa Tracker Android App.</p>
                    </a>
                  </div>
                  <div class="onthego-item onthego-chrome">
                    <a href="//www.google.com/chrome/santatracker/">
                      <div class="logo"></div>
                      <h2>Deck out</h2>
                      <p>Deck out your browser with a Santa Chrome extension.</p>
                    </a>
                  </div>
                  <div class="onthego-item onthego-cast">
                    <a href="//play.google.com/store/apps/details?id=com.google.android.apps.santatracker">
                      <div class="logo"></div>
                      <h2>Light up</h2>
                      <p>Light up your TV with the Santa Tracker Android app and Chromecast.</p>
                    </a>
                  </div>
                </div>
              </section>
            </core-animated-pages>
          </div>

        </div>
        <div id="global-nav-footer">
          <!-- TODO(lukem): put back goro stuff -->
          <!-- <div style="display:inline"><a href="#" id="select-lang">{% msg %}Language{% endmsg %}</a> &bull;</div>
          <a href="{{'www.google.com/santatracker/about.html'|localizedpath:goro.page.locale}}">About</a>
          &bull;
          <a href="http://www.google.com/policies/">Terms &amp; Privacy</a>
          &bull; -->
          <a href="http://maps.google.com/help/maps/helloworld/index.html">Get Google Maps</a>
          <a href="" on-click="{{route='asdf'}}">Santa on the go</a>
        </div>
      </div>

      <div id="site-nav">
        <h2>Santa Tracker</h2>
        <div class="share">
          <ul>
            <li><a href="#" class="gplus" on-tap="{{shareGplus}}"><i>Google+</i></a></li>
            <li><a href="#" class="fb" on-tap="{{shareFB}}"><i>Facebook</i></a></li>
            <li><a href="#" class="twitter" on-tap="{{shareTwitter}}"><i>Twitter</i></a></li>
          </ul>
        </div>
      </div>

    </div>

  </template>
  <script>
  (function() {

    var importURL = document._currentScript.ownerDocument.baseURI + '/../';

    Polymer({

      //TODO(lukem): Rewrite this whole thing when new nav comes from designers

      opened: false,
      opening: false,
      closed: true,
      closing: false,

      TIMEOUT_DELAY: 300 + (24 * 42),

      get componentURL() {
        return importURL;
      },

      ready: function() {
        this.houses = [
          {module: 'airport', iced: false, category: 'scene'},
          {module: 'racer', iced: false, category: 'play'},
          {module: 'video', iced: false, category: 'play'},
          {module: 'playstore', iced: false, category: 'play'},

          {module: 'selfie', iced: true, category: 'play'},
          {module: 'boatload', iced: true, category: 'play'},
          {module: 'radar', iced: true, category: 'play'},
          {module: 'memory', iced: true, category: 'play'},
          {module: 'presentdrop', iced: true, category: 'play'},
          {module: 'toyfactory', iced: true, category: 'play'},
          {module: 'jamband', iced: true, category: 'code'},
          {module: 'codelab', iced: true, category: 'listen'},
          {module: 'translations', iced: true, category: 'watch'},
          {module: 'video', iced: true, category: 'play'},
          {module: 'mercator', iced: true, category: 'play'},
          {module: 'controlroom', iced: true, category: 'play'},
          {module: 'play', iced: true, category: 'draw'},
          {module: 'candy', iced: true, category: 'play'},
          {module: 'jetpack', iced: true, category: 'watch'},
          {module: 'streetview', iced: true, category: 'send'},
          {module: 'postcard', iced: true, category: 'learn'},
          {module: 'traditions', iced: true, category: 'play'},
          {module: 'testing', iced: true, category: 'play'},
          {module: 'gumball', iced: true, category: 'play'},
          {module: 'citylights', iced: true, category: 'play'},
          {module: 'video', iced: true, category: 'watch'},
          {module: 'tracker', iced: true, category: 'Tracker'}
        ];

        this.firstFour = this.houses.slice(0, 4);
        this.regularSchedule = this.houses.slice(4);
      },

      onShow: function() {
        this.cancelAsync(this.closeTimeout_);

        this.$['global-nav-content'].scrollTop = 0;
        this.$.tabs.selected = 'calendar';

        this.closed = this.closing = this.scrollable = false;
        this.opening = true;

        this.async(function() {
          this.opened = true;

          this.async(function() {
            this.scrollable = true;
          }, null, this.TIMEOUT);
        });

        this.playSound('menu_open');

         // TODO(ericbidelman): throws errors with visibilityService being undefined.
        this.visibilityService.pause();
      },

      onHide: function() {
        this.opening = this.opened = this.scrollable = false;
        this.closing = true;

        this.closeTimeout_ = this.async(function() {
          this.route = 'village/calendar';
          this.closed = true;
        }, null, this.TIMEOUT_DELAY);

        this.playSound('menu_close');

         // TODO(ericbidelman): throws errors with visibilityService being undefined.
        this.visibilityService.resume();
      },

      /**
       * @param {Event} e
       * @return {boolean} false to cancel the bubble
       * @private
       */
      changeNavTab: function(e) {

        // $('#global-nav-header .active').removeClass('active');
        // var link = $(e.target);
        // link.addClass('active');
        // var type = link.attr('href').substring(1);

        // if (type == 'calendar') {
        //   $('#nav-calendar').show();
        //   $('#nav-onthego').hide();
        // } else {
        //   $('#nav-onthego').show();
        //   $('#nav-calendar').hide();
        // }
        // return false;

      },

      addEvents: function() {

        var container = this.$['#site-nav'];

        $('#global-nav-content li').on('click', 'a.melt', _.bind(this.close, this));

        $('#nav-calendar ul li').on('click', 'a', function() {
          if ($(this).hasClass('iced')) return false;
        });

        $('#global-nav-header ul li').on('click', 'a',
            _.bind(this.changeNavTab, this));
        this.addLanguageSelectEvents_();

        $('#nav-onthego a').on('click', function() {
          var href = $(this).attr('href');
          window.santatracker.analytics.trackEvent('outbound', 'click', href);
          window.setTimeout(function() {
            document.location.href = href;
          }.bind(this), 100);
          return false;
        });

      },

      /**
       * @private
       */
      addLanguageSelectEvents_: function() {
        /*
        $('#select-lang').on('click', function(e) {
          $('#page-language').show();
          e.preventDefault(); // necessary for standalone village, but not web.
        });

        // Prevent a click on the language select from closing the form.
        $('#language-content').on('click', function(e) {
          return false;
        });

        var hidePopup = function() {
          $('#page-language').hide();
          return false;
        };

        $('#page-language').on('click', hidePopup);
        $('#close-lang').on('click', hidePopup);

        $('#language').val(window.santatracker.lang);

        $('#language').on('change', function() {
          var lang = $(this).val();
          window.santatracker.analytics.trackEvent('language', 'click', 'change',
              lang);
          window.setTimeout(function() {
            window.location = '/intl/' + lang + '/santatracker/' +
                window.location.hash;
          }, 100);
        });
        */
      },


      shareGplus: function() {
        /*
        window.santatracker.analytics.trackSocial('googleplus', 'share',
            'http://www.google.com/santatracker');
        this.openPage_('https://plus.google.com/share?url=' +
                       encodeURIComponent('http://www.google.com/santatracker'));
        */
      },

      shareFB: function() {
        /*
        window.santatracker.analytics.trackSocial('facebook', 'share',
            'http://www.google.com/santatracker');

        this.openPage_('http://www.facebook.com/sharer.php?u=' +
                       encodeURIComponent('http://www.google.com/santatracker') +
                       '&t=' + encodeURIComponent('Google Santa Tracker'));
        */
      },

      shareTwitter: function() {
        /*
        window.santatracker.analytics.trackSocial('twitter', 'share',
            'http://www.google.com/santatracker');

        this.openPage_('http://twitter.com/share?text=' +
                       encodeURIComponent('Google Santa Tracker - ' +
                       'Follow Santa on his journey around the ' +
                       'world -') + '&url=' +
                       encodeURIComponent('http://www.google.com/santatracker'));
        */
      },

      /**
       * Open a fixed size window to a url
       * @param {string} url
       */
      openPage_: function(url) {
        window.open(url, 'Share', 'toolbar=0,status=0,width=626,height=480');
      }

    });

  })();
  </script>
</polymer-element>
