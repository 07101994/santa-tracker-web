<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/core-pages/core-pages.html">

<!--
Lazy loads children "pages".

@element lazy-pages
@extends core-pages
-->
<polymer-element name="lazy-pages" extends="core-pages">
<template>
  <style>
    :host {
      position: initial;
    }
  </style>
  <shadow></shadow>
</template>
<script>
  Polymer({

    /**
     * Santa service.
     *
     * @property santaService
     * @type SantaService
     * @default null
     */
    santaService: null,

    /**
     * Analytics service.
     *
     * @property analyticsService
     * @type Analytics
     * @default null
     */
    analyticsService: null,

    /**
     * Page/Scene visibility manager.
     *
     * @property visibilityService
     * @type VisiblityManager
     * @default null
     */
    visibilityService: null,

    selectedChanged: function() {
      this.super();

      var scene = this.selectedItem;

      // Can't use scene.path because element definition may not be loaded yet
      // and .path property won't exist.
      var path = scene.getAttribute('path');

      if (!path || !scene || !this.selected || scene.loaded) {
        return;
      }

      Polymer.import([path], function(e) {
        // TODO: shouldn't have to do this. I believe 2-way binding on the
        // preload-overlay is causing the next scene to start at 100 instead
        // of 0. Probably need to fire an event instead of binding to its
        // .value directly.
        scene.preloadProgress = 0;

        scene.santaService = this.santaService;
        scene.analyticsService = this.analyticsService;
        scene.visibilityService = this.visibilityService;

      }.bind(this));

    }
  });
</script>
</polymer-element>
