<link rel="import" href="../../../components/polymer/polymer.html">
<link rel="import" href="../../../components/core-list/core-list.html">
<link rel="import" href="../../../components/core-pages/core-pages.html">
<link rel="import" href="../../../components/core-selector/core-selector.html">
<!-- <link rel="import" href="../../../components/google-streetview-pano/google-map-streetview-panorama.html"> -->

<link rel="import" href="../../../js/utils.html">

<polymer-element name="html-echo" attributes="html">
<script>
Polymer({
  htmlChanged: function() {
    this.innerHTML = this.html;
  }
});
</script>
</polymer-element>

<!--
City feed view in Tracker

@element city-feed
-->
<polymer-element name="city-feed" attributes="active location destinations">
<template>
<link rel="stylesheet" href="city-feed.css" no-shim>
<style>
:host {
  display: none;
}
:host([active]) {
  display: block;
}
</style>

<div id="module-city-feed" fit>
  <div class="scene" fit>

<core-list data="{{dests}}" selectionEnabled="false" height="450" style="height:100%">
  <template>

<div class="card city">
  <div id="header">
    <div class="corner-image general"></div>
    <div>
      <h4 class="white">{{model.region}}</h4>
      <h1>{{model.city}}</h1>
    </div>
    <core-selector class="card-icons" selected="{{model.selectedCard}}">
      <img src="img/tracker-and-city-SVGs_feed-city-icon.svg">
      <img src="img/tracker-and-city-SVGs_feed-city-photo-icon.svg">
      <img src="img/tracker-and-city-SVGs_feed-city-sv-icon.svg">
      <img src="img/tracker-and-city-SVGs_feed-city-wiki-icon.svg">
    </core-selector>
    <div id="stats">
      <div layout horizontal>
        <div>
          <h4><i18n-msg msgid="tracker_arrival">PLACEHOLDER_i18n</i18n-msg></h4>
          <div layout horizontal center>
            <div class="ico ico-clock"></div>
            <h2 class="stat-large">{{model.arrival | formatCountdown}}</h2>
          </div>
        </div>
        <div>
          <h4><i18n-msg msgid="tracker_weather">PLACEHOLDER_i18n</i18n-msg></h4>
          <div layout horizontal center>
            <div class="ico ico-clock"></div>
            <h2 class="stat-large white">{{model.details.weather.tempC}}&deg;C / {{model.details.weather.tempF}}&deg;F</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <core-pages class="card-content" selected="{{model.selectedCard}}">
    <div class="photo" relative _style="background-image:url({{model.details.photos[0].url}})">
      <div class="attribution"><html-echo html="{{model.details.photos[0].attributionHtml}}"></html-echo></div>
    </div>
   <!--  <google-map-streetview-panorama panoid="{{model..streetView.id}}"
        heading="{{model.streetView.heading}}" disableDefaultUI></google-map-streetview-panorama> -->
  </core-pages>
</div>

  </template>
</core-list>

</template>

  </div>
</div>

</template>
<script>
(function() {
Polymer({
  componentDir: 'scenes/tracker/',

  publish: {
    /**
     * If `true`, the feed is showing.
     *
     * @attribute active
     * @type bool
     * @default false
     */
    active: {value: false, reflect: true}
  },

  created: function() {
    this.location = {};
    this.destinations = [];
  },

  onPreload: function() {
    this.preloadImages([

    ]);
  },

  onShow: function() {
    this.sceneParamsChanged();
  },

  onHide: function() {

  },

  sceneParamsChanged: function() {

  },

  destinationsChanged: function() {
    if (!this.destinations || !this.destinations.length) {
      return;
    }

    for (var i = 0, dest; dest = this.destinations[i]; ++i) {
      dest.selectedCard = 0;
      dest.index = i;
    }

this.dests = this.destinations;
  },

  formatCountdown: function(timestamp) {
    return formatCountdown(timestamp);
  }
});

})();
</script>
</polymer-element>
