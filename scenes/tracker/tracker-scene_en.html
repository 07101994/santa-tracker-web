<link rel="import" href="../base-scene.html">
<link rel="import" href="../../elements/i18n-msg.html">
<link rel="import" href="../../components/google-apis/google-maps-api.html">

<script src="../shared/js/mapstyles.js"></script>

<!--
Tracker scene.

@element tracker-scene
@extends base-scene
-->
<polymer-element name="tracker-scene" extends="base-scene">
<template>
  <link rel="stylesheet" href="tracker-scene.css" no-shim>

  <div id="module-tracker">

    <div class="scene" fit>

      <template if="{{santaApp}}">
        <google-maps-api version="3.exp" apiKey="{{santaApp.config.API_KEY}}"
                         clientId="{{santaApp.config.CLIENT_ID}}"
                         libraries="places,geometry"
                         language="{{santaApp.language}}"
                         on-api-load="{{mapsAPIReady}}"></google-maps-api>
      </template>

      <div id="trackermap"></div>

      <div class="sceneboard">
        <a id="global-back-to-village" href="{{pageUrl}}#village" class="back">
          <i18n-msg msgid="gotovillage">PLACEHOLDER_i18n</i18n-msg>
        </a>
        <div class="sceneboard-back"></div>
      </div>
    </div>
  </div>
</template>
<script>
(function() {
  Polymer({
    componentDir: 'scenes/tracker/',

    /**
     * Latitude of the main map's center. Ususally Santa's location.
     * @type Number
     * @private
     */
    latitude_: null,

    /**
     * Longitude of the main map's center. Ususally Santa's location.
     * @type Number
     * @private
     */
    longitude_: null,

    santaAppChanged: function() {
      this.santaApp.santaService.getCurrentLocation(function(location) {
        this.latitude_ = location.position.lat;
        this.longitude_ = location.position.lng;
      }.bind(this));
    },

    mapsAPIReady: function(e, detail, sender) {
      this.map = new google.maps.Map(this.$.trackermap, {
        center: new google.maps.LatLng(0, 0),
        zoom: 5,
        disableDefaultUI: true,
        scrollwheel: false,
        draggable: false,
        disableDoubleClickZoom: true,
        backgroundColor: '#f6efe2',
        // It's important that we have map styles -- this prevents a call to
        // staticmap.
        styles: mapstyles.styles
      });
    },

    onPreload: function() {
      this.preloadImages([
        'img/smallglobe.svg'
      ]);
    },

    onShow: function() {
      // TODO: implement

    },
    onHide: function() {
      // TODO: implement
    }
  });
})();
</script>
</polymer-element>
