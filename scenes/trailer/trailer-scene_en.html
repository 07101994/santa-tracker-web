<link rel="import" href="../base-scene.html">
<link rel="import" href="../../components/google-youtube/google-youtube.html">
<link rel="import" href="../../elements/i18n-msg.html">

<!--
Trailer scene.

@element trailer-scene
@extends base-scene
-->
<polymer-element name="trailer-scene" extends="base-scene">
<template>
  <link rel="stylesheet" href="trailer-scene.css" no-shim>

  <div id="module-trailer" fit>
    <div class="scene" fit>
      <div id="poster">
        <div id="start" hidden>
          <div class="start-button" on-tap="{{playVideo}}"></div>
        </div>
      </div>
      <google-youtube fit id="player" videoid="QrDH6kh7yUw" chromeless fluid="1"
                      on-google-youtube-ready="{{youtubeReady}}"
                      on-google-youtube-state-change="{{youtubeStateChange}}"></google-youtube>

      <div id="videoboard" class="sceneboard">
        <a id="global-back-to-village" href="{{baseURI}}#village" class="back"><i18n-msg msgid="gotovillage">PLACEHOLDER_i18n</i18n-msg></a>
        <div class="sceneboard-back"></div>
        <div id="controls" hidden>
          <div class="scrubber">
            <div class="tracker" style="transform: translateX({{($.player.currenttime / $.player.duration) * 150}}px)">{{$.player.currenttimeformatted}}</div>
          </div>
          <ul class="actions">
            <li id="restart" class="restart" on-tap="{{restartVideo}}"></li>
            <li id="pause" class="pause {{ {paused: paused} | tokenList }}" on-tap="{{togglePause}}"></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
  Polymer({
    componentDir: 'scenes/trailer/',
    player: null,
    paused: false,

    ready: function() {
      this.player = this.$['player'];
    },

    youtubeStateChange: function(e) {
      if (e.detail.data == 0) {
        this.$['poster'].hidden = false;
        this.$['controls'].hidden = true;
      }
    },

    youtubeReady: function() {
      this.$['start'].hidden = false;
    },

    restartVideo: function() {
      this.player.seekTo(0);
      this.player.play();
    },

    togglePause: function() {
      this.paused = !this.paused;
      this.$['pause'].paused = this.paused;
      if (this.paused) {
        this.player.pause();
      } else {
        this.player.play();
      }
    },

    playVideo: function() {
      // TODO(lukem): hook up to global mute
      this.$['poster'].hidden = true;
      this.$['controls'].hidden = false;
      this.player.play();
    },

    onPreload: function() {
      this.preloadImages([
        'img/button.svg',
        'img/pause.svg',
        'img/play.svg',
        'img/poster.svg',
        'img/restart.svg'
      ]);
    },

    onShow: function() {
      this.player.seekTo(0);
      this.$['controls'].hidden = true;
      this.$['poster'].hidden = false;
      this.$['controls'].hidden = true;
    },

    onHide: function() {
      this.player.pause();
    }
  });
</script>
</polymer-element>
