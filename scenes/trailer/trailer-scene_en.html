<link rel="import" href="../base-scene.html">
<link rel="import" href="../../components/google-youtube/google-youtube.html">
<link rel="import" href="../../elements/i18n-msg.html">

<!--
Trailer scene.

@element trailer-scene
@extends base-scene
-->
<polymer-element name="trailer-scene" extends="base-scene">
<template>
  <link rel="stylesheet" href="trailer-scene.css" no-shim>

  <div id="module-trailer" fit>
    <div class="scene" fit>
      <div id="poster" hidden?="{{!poster}}">
        <div id="start" hidden?="{{!start}}">
          <div class="start-button" on-tap="{{playVideo}}"></div>
        </div>
      </div>
      <google-youtube id="player" videoid="IdpQSy4IB_I" chromeless playsupported
                      on-google-youtube-ready="{{youtubeReady}}"
                      on-google-youtube-state-change="{{youtubeStateChange}}"
                      height="100%" width="100%" fit></google-youtube>

      <div id="videoboard" class="sceneboard">
        <a id="global-back-to-village" href="{{pageUrl}}#village" class="back">
          <i18n-msg msgid="gotovillage">PLACEHOLDER_i18n</i18n-msg>
        </a>
        <div class="sceneboard-back"></div>
        <div id="controls" hidden?="{{!controls}}">
          <div class="scrubber">
            <div class="tracker" style="transform: translateX({{($.player.currenttime / $.player.duration) * 150}}px)">{{$.player.currenttimeformatted}}</div>
          </div>
          <ul class="actions">
            <li id="restart" class="restart" on-tap="{{restartVideo}}"></li>
            <li id="pause" class="pause {{ {paused: paused} | tokenList }}" on-tap="{{togglePause}}"></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
  Polymer({
    componentDir: 'scenes/trailer/',

    /**
     * True if the video is paused.
     *
     * @property paused
     * @type bool
     * @default true
     */
    paused: true,

    /**
     * True if the poster image should show.
     *
     * @property poster
     * @type bool
     * @default false
     */
    poster: true,

    /**
     * True if the start button should show.
     *
     * @property start
     * @type bool
     * @default true
     */
    start: false,

     /**
     * True if the scene board play controls should show.
     *
     * @property controls
     * @type bool
     * @default false
     */
    controls: false,

    youtubeReady: function() {
      this.start = true;
    },

    youtubeStateChange: function(e, detail, sender) {
      var state = e.detail.data;

      switch (state) {
        case 0: // ended
          this.poster = true
          this.controls = false;
          break;;
        case 1: // playing
          this.paused = false;
          break;
        case 2: // paused
          this.paused = true;
          break;
      }
    },

    restartVideo: function() {
      this.$.player.seekTo(0);
      this.$.player.play();
    },

    togglePause: function() {
      this.paused = !this.paused;
      if (this.paused) {
        this.$.player.pause();
      } else {
        this.$.player.play();
      }
    },

    playVideo: function() {
      this.poster = false;
      this.controls = true;
      this.$.player.play();
    },

    onPreload: function() {
      this.preloadImages([
        'img/button.svg',
        'img/pause.svg',
        'img/play.svg',
        'img/poster.svg',
        'img/restart.svg'
      ]);
    },

    onShow: function() {
      this.$.player.seekTo(0);
      this.$.player.pause();
      this.controls = false;
      this.poster = true;
      this.fire('sound-ambient', 'global_sound_off');
    },

    onHide: function() {
      this.$.player.pause();
      this.fire('sound-ambient', 'global_sound_on');
    },

    onPause: function() {
      this.$.player.pause();
    },

    onResume: function() {
      if (!this.poster) {
        this.$.player.play();
      }
    }
  });
</script>
</polymer-element>
