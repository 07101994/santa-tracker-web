<!DOCTYPE html>
<html lang="en" itemscope="itemscope" itemtype="http://schema.org/WebPage">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
  <base href="">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <title>Google Santa Tracker</title>
  <meta property="og:title" itemprop="name" content="Google Santa Tracker">
  <meta property="og:type" content="website">
  <meta property="og:image" itemprop="image" name="thumbnail" content="images/og.png">
  <meta property="og:description" itemprop="description" name="description" content="Use Google Santa Tracker to follow Santa Claus on Google Maps as he makes his journey around the world.">

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,600,700,800|Lobster">
  <link rel="stylesheet" href="sass/santatracker.css">

  <!-- app manifest-->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes"> <!-- fallback -->

  <!-- app status bar themes -->
  <meta name="apple-mobile-web-app-status-bar-style" content="#e51c23">
  <meta name="theme-color" content="#e51c23">
  <meta name="msapplication-TileColor" content="#e51c23">

  <meta name="msapplication-tap-highlight" content="no">

  <!-- icons -->
  <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="images/apple-touch-icon-57x57-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/apple-touch-icon-72x72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/apple-touch-icon-114x114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/apple-touch-icon-144x144-precomposed.png">
  <link rel="shortcut icon" href="images/favicon.ico">

  <!-- Analytics -->
  <script src="//www.google.com/js/gweb/analytics/autotrack.js"></script>
  <script>
    window.DEV = true; // NOTE: replaced by string - do not change formatting.

    window.ga_ = new gweb.analytics.AutoTrack({
      'profile': window['DEV'] ? 'UA-37048309-2' : 'UA-37048309-1',
      'trackClicks': false,
      'disableTrackPageview': true
    });

    // log navigation timing numbers at a higher rate to get a better baseline
    // while traffic is still low
    ga_.pushCommand(['_setSiteSpeedSampleRate', 10]);
  </script>

  <script src="components/webcomponentsjs/webcomponents.min.js"></script>
  <link rel="import" href="elements/elements_en.html">
</head>
<body unresolved fullbleed>

<santa-app id="santaApp"></santa-app>

<div id="timer" role="timer" aria-live="agressive" aria-atomic="false" aria-relevant="additions"></div>

<div id="preload_placeholder"></div>

<script>
window.santaApp = document.querySelector('santa-app');

// TODO(bckenny): could ask embeds to include separate utm_source
if (getUrlParameter('api_client')) {
  ga_.pushCommand(['_setCampSourceKey', 'api_client']);
  ga_.pushCommand(['_setCampMediumKey', 'api_client']);
}

// TODO(bckenny): check browser for polymer support. If unsupported, track
// pageview before redirecting

if (!window.DEV) {
  console.log = function(){};
}

(function() {
  // performance.now() polyfill for browsers without support
  var perfNow = window.performance && window.performance.now ?
      window.performance.now.bind(window.performance) : Date.now;

  // Track and log any errors to analytics
  window.onerror = function(message, file, lineNumber) {
    // We don't want to trigger any errors inside window.onerror otherwise
    // things will get real bad, real quick.
    try {
      window.ga_.pushCommand(['_trackEvent', 'error', file + ':' + lineNumber,
          '' + message]);
    } catch (e){}
  };

  // log some polymer performance numbers
  document.addEventListener('HTMLImportsLoaded', function() {
    var now = perfNow();
    window.ga_.pushCommand(['_trackTiming', 'Polymer', 'HTMLImportsLoaded', now]);

    if (window.DEV) {
      console.info('HTMLImportsLoaded @', now, 'ms');

      // Polyfill needs I18nMsg to exist before setting the lang. Timing is fine for native :(
      // Set locale for entire site (e.g. i18n-msg elements).
      I18nMsg.lang = document.documentElement.lang || 'en';
    }
  });

  document.addEventListener('polymer-ready', function() {
    var now = perfNow();
    window.ga_.pushCommand(['_trackTiming', 'Polymer', 'polymer-ready', now]);

    if (window.DEV) {
      console.info('polymer-ready @', now, 'ms');
    }
  });

// Try to only do screen reader stuff on desktop.
if (window.matchMedia('(min-width: 1000px)').matches) {
  var timer = document.querySelector('#timer');

  document.addEventListener('countdown-timer-tick', function(e) {
    var currentTime = e.detail.currentTime;

    if (currentTime.diff <= 60 * 1000) {
      timer.textContent = e.detail.msg;
    } else if (currentTime.seconds % 10 == 0) { // Only update DOM (and therefore speak text) every 10 seconds.
      timer.textContent = e.detail.msg;
    }
  });
}
})();
</script>
</body>
</html>
