function AudioController(){this.audioBuffer_=null;this.source_=null;this.audioContext_=null;this.loaded=false;if(this.isSupported){if("AudioContext"in window){this.audioContext_=new window.AudioContext}else{this.audioContext_=new window.webkitAudioContext}}}AudioController.prototype.isSupported="AudioContext"in window||"webkitAudioContext"in window;AudioController.prototype.load=function(url,opt_callback){this.loaded=false;var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";var that=this;xhr.onload=function(e){that.audioContext_.decodeAudioData(this.response,function(buffer){that.audioBuffer_=buffer;that.loaded=true;if(opt_callback){opt_callback()}})};xhr.send()};AudioController.prototype.play=function(opt_gain,opt_loop){if(this.isSupported&&this.loaded&&this.audioBuffer_){this.source_=this.audioContext_.createBufferSource();this.source_.buffer=this.audioBuffer_;this.source_.loop=opt_loop||false;var gainNode=this.audioContext_.createGainNode();gainNode.gain.value=opt_gain||1;this.source_.connect(gainNode);gainNode.connect(this.audioContext_.destination);this.source_.noteOn(0)}};AudioController.prototype.stop=function(){if(this.source_){this.source_.noteOff(0)}};Modernizr.addTest("webaudio",!!(window.AudioContext||window.webkitAudioContext));function mapsLatLng(o){return new google.maps.LatLng(o.lat,o.lng)}function noop(){}function forwardMapsEvent(origin,eventName,target){return origin.addListener(eventName,google.maps.event.trigger.bind(this,target,eventName))}function pad(n){if(n>9){return n}return"0"+n}function formatInt(n){if(n<1e3){return n.toFixed(0)}var s=n.toFixed(0);var ret="";while(s.length>3){var l=s.length-3;ret=s.slice(l)+(ret?formatInt.sep:"")+ret;s=s.slice(0,l)}return ret=s+formatInt.sep+ret}formatInt.sep=.1.toLocaleString().indexOf(",")!=-1?".":",";function assert(condition,opt_message){if(window["DEV"]&&!condition){throw new Error("Assertion failed"+(opt_message?": "+opt_message:""))}}var setText=function(){if("textContent"in document){return function(el,text){el.textContent=text}}else{return function(el,text){el.innerText=text}}}();function windowWidth(){return window.innerWidth||document.documentElement.clientWidth}function windowHeight(){return window.innerHeight||document.documentElement.clientHeight}var VillageUtils={};VillageUtils.forwardEvent=function(origin,eventName,target,newEventName){if(!newEventName){newEventName=eventName}return Events.addListener(origin,eventName,Events.trigger.bind(window,target,newEventName))};VillageUtils.CSS_TRANSFORM=Modernizr.csstransforms?Modernizr.prefixed("transform"):"transform";VillageUtils.TRANSITIONS_SUPPORTED=Modernizr.csstransitions;VillageUtils.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};function VillageBus(el){this.container_=el;this.bus_=this.container_.querySelector("#bus");this.isPaused_=true}VillageBus.ANIMATION_TIMES_={BUS_ARRIVAL_TIME:8e3,BUS_LOAD_TIME:3e3,BUS_DEPARTURE_TIME:1e4,BUS_PAD_TIME:500,RANDOM_BUS_MIN_TIME:3e4,RANDOM_BUS_MAX_TIME:6e4};VillageBus.prototype.start=function(){this.busEmpty_=true;this.busInTransit_=false;this.busStopQueue_=[];this.isPaused_=false;this.sendRandomBus_()};VillageBus.prototype.resume=function(){this.isPaused_=false;if(!this.busInTransit_){this.scheduleRandomBus_()}};VillageBus.prototype.pause=function(){this.isPaused_=true;window.clearTimeout(this.randomBusTimeoutID_)};VillageBus.prototype.stop=function(){window.clearTimeout(this.randomBusTimeoutID_);window.clearTimeout(this.leaveStopTimeoutID_);this.bus_.className=""};VillageBus.prototype.sendBusToStop=function(stopNumber){var stop=this.container_.querySelector("#busstop"+stopNumber);var stopEmpty=stop.classList.contains("stop-empty");if(this.busInTransit_){if(!this.busStopQueue_.indexOf(stopNumber)!=-1){if(!stopEmpty){stop.classList.add("stop-waiting")}this.busStopQueue_.push(stopNumber)}return}if(this.randomBusTimeoutID_>=0){window.clearTimeout(this.randomBusTimeoutID_);this.randomBusTimeoutID_=-1}this.bus_.classList.add("to-stop"+stopNumber);this.busInTransit_=true;if(stopEmpty){this.bus_.classList.switch("bus-unload","bus-load")}else{this.bus_.classList.switch("bus-load","bus-unload")}var timeUntilLoad=VillageBus.ANIMATION_TIMES_.BUS_ARRIVAL_TIME+VillageBus.ANIMATION_TIMES_.BUS_PAD_TIME;var leaveStopFn=function(){var classList=this.bus_.classList;classList.toggle("bus-unload");classList.toggle("bus-load");classList.toggle("to-stop"+stopNumber);classList.toggle("leave-stop");this.busEmpty_=!this.busEmpty_;window.setTimeout(function(){stop.classList.toggle("stop-empty");stop.classList.remove("stop-waiting")},VillageBus.ANIMATION_TIMES_.BUS_LOAD_TIME/2);var timeUntilReset=VillageBus.ANIMATION_TIMES_.BUS_LOAD_TIME+VillageBus.ANIMATION_TIMES_.BUS_DEPARTURE_TIME+VillageBus.ANIMATION_TIMES_.BUS_PAD_TIME;var arriveAtStopFn=function(){this.bus_.classList.remove("leave-stop");this.busInTransit_=false;if(this.busStopQueue_.length){var stopId=this.busStopQueue_.shift();window.setTimeout(this.sendBusToStop.bind(this,stopId),1)}else{this.scheduleRandomBus_()}};window.setTimeout(arriveAtStopFn.bind(this),timeUntilReset)};this.leaveStopTimeoutID_=window.setTimeout(leaveStopFn.bind(this),timeUntilLoad)};VillageBus.prototype.sendRandomBus_=function(){if(this.isPaused_)return;var stopNumber=Math.floor(Math.random()*3)+1;this.sendBusToStop(stopNumber)};VillageBus.prototype.scheduleRandomBus_=function(){var randomBusTime=VillageBus.ANIMATION_TIMES_.RANDOM_BUS_MIN_TIME+Math.random()*(VillageBus.ANIMATION_TIMES_.RANDOM_BUS_MAX_TIME-VillageBus.ANIMATION_TIMES_.RANDOM_BUS_MIN_TIME);this.randomBusTimeoutID_=window.setTimeout(this.sendRandomBus_.bind(this),randomBusTime)};function SnowFlake(element,animationLength){this.element_=element[0];this.animationLength_=animationLength;var animationDelay=Math.round(-animationLength*Math.random())+"ms";element.find(".snow-flake-inner").css(SnowFlake.ANIMATION_DELAY_,animationDelay)}SnowFlake.ANIMATION_DELAY_=Modernizr.cssanimations?Modernizr.prefixed("animationDelay"):"animationDelay";SnowFlake.TRANSITION_DURATION_=Modernizr.csstransitions?Modernizr.prefixed("transitionDuration"):"transitionDuration";SnowFlake.prototype.startAnimation=function(newLeft,reclaimCallback){var flake=this.element_;var that=this;window.requestAnimationFrame(function(){flake.style[VillageUtils.CSS_TRANSFORM]="translateX("+newLeft+"px) translateY(-20px)";flake.style[SnowFlake.TRANSITION_DURATION_]="0s";flake.style.opacity=".99";window.requestAnimationFrame(function(){flake.style[VillageUtils.CSS_TRANSFORM]="translateX("+newLeft+"px) translateY("+windowHeight()+"px)";flake.style[SnowFlake.TRANSITION_DURATION_]="";flake.style.opacity=".25";window.setTimeout(function(){flake.style[VillageUtils.CSS_TRANSFORM]="";flake.style[SnowFlake.TRANSITION_DURATION_]="0s";flake.style.opacity="";reclaimCallback(that)},that.animationLength_)})})};function VillageSnow(el){this.container_=el;this.snowing_=false;this.freeFlakeIndex_=0;this.maxNumFlakes_=0;this.animate_=!navigator.userAgent.match(/firefox/i);this.snowFlakeTemplate_=$('<div><div class="snow-flake-inner"/></div>').addClass("snow-flake");if(this.animate_){this.snowFlakeTemplate_.addClass("snow-flake-animated")}this.freeFlakeList_=[];this.reclaimCallback_=this.reclaimSnowFlake_.bind(this);this.calcAndAssignMaxNumFlakes_();$(window).resize(this.calcAndAssignMaxNumFlakes_.bind(this))}VillageSnow.SNOW_FLAKES_=[{name:"snow-flake-large",time:15e3},{name:"snow-flake-medium",time:2e4},{name:"snow-flake-small",time:25e3}];VillageSnow.MAX_SNOW_FLAKES_=70;VillageSnow.SNOW_FLAKE_TIME_=700;VillageSnow.prototype.start=function(){if(!this.snowing_){this.snowing_=true;if($(document.body).hasClass("chromecast")){return}this.scheduleSnowFlake_()}};VillageSnow.prototype.stop=function(){this.snowing_=false};VillageSnow.prototype.calcAndAssignMaxNumFlakes_=function(){var windowWidth=$(window).width();var pixelsPerFlake=50;var maxFlakes=Math.min(Math.round(windowWidth/pixelsPerFlake),VillageSnow.MAX_SNOW_FLAKES_);if(maxFlakes>this.maxNumFlakes_){var parent=$("#village-wrapper",this.container_);for(var i=0;i<maxFlakes-this.maxNumFlakes_;i++){var size=VillageSnow.SNOW_FLAKES_[Math.floor(Math.random()*VillageSnow.SNOW_FLAKES_.length)];var snow=this.snowFlakeTemplate_.clone().addClass(size.name);parent.append(snow);var flake=new SnowFlake(snow,size.time);this.freeFlakeList_[this.freeFlakeIndex_]=flake;this.freeFlakeIndex_++}this.maxNumFlakes_=maxFlakes}};VillageSnow.prototype.addSnowFlake_=function(){this.snowTimeout_=null;if(!this.snowing_){return}if(this.freeFlakeIndex_>0){var flake=this.freeFlakeList_[this.freeFlakeIndex_-1];this.freeFlakeList_[this.freeFlakeIndex_-1]=null;this.freeFlakeIndex_--;var randLeft=Math.random()*windowWidth();flake.startAnimation(randLeft,this.reclaimCallback_);if(this.freeFlakeIndex_>0){this.scheduleSnowFlake_()}}};VillageSnow.prototype.reclaimSnowFlake_=function(flake){this.freeFlakeList_[this.freeFlakeIndex_]=flake;this.freeFlakeIndex_++;this.scheduleSnowFlake_()};VillageSnow.prototype.scheduleSnowFlake_=function(){if(this.snowing_&&!this.snowTimeout_){var timeout=Math.random()*VillageSnow.SNOW_FLAKE_TIME_;this.snowTimeout_=window.setTimeout(this.addSnowFlake_.bind(this),timeout)}};function VillageSnowMobile(el){this.container_=el}VillageSnowMobile.BURNOUT_ANIMATION_TIME_=25e3;VillageSnowMobile.MIN_BURNOUT_TIME_=2e4;VillageSnowMobile.MAX_BURNOUT_TIME_=6e4;VillageSnowMobile.prototype.start=function(){this.scheduleRandomSnowMobile_()};VillageSnowMobile.prototype.stop=function(){window.clearTimeout(this.randomSnowMobileTimeoutID_)};VillageSnowMobile.prototype.driveSnowMobile=function(snowMobile){this.scheduleRandomSnowMobile_();if(!snowMobile.classList.contains("interactive")){return}snowMobile.classList.switch("interactive","gogo-snowmobile");window.setTimeout(function(){snowMobile.classList.switch("gogo-snowmobile","interactive")},VillageSnowMobile.BURNOUT_ANIMATION_TIME_)};VillageSnowMobile.prototype.sendRandomSnowMobile_=function(){var snowMobileId=Math.floor(Math.random()*3)+1;this.driveSnowMobile(this.container_.querySelector("#snowmobile"+snowMobileId))};VillageSnowMobile.prototype.scheduleRandomSnowMobile_=function(){window.clearTimeout(this.randomSnowMobileTimeoutID_);var randomSnowMobileTime=VillageSnowMobile.MIN_BURNOUT_TIME_+Math.random()*VillageSnowMobile.MAX_BURNOUT_TIME_;this.randomSnowMobileTimeoutID_=window.setTimeout(this.sendRandomSnowMobile_.bind(this),randomSnowMobileTime)};function VillageClouds(){this.numClouds_=0}VillageClouds.ANIMATION_TIME_=12e4;VillageClouds.MAX_NUM_OF_CLOUDS_=15;VillageClouds.MIN_CLOUD_ADD_TIME_=1e3;VillageClouds.MAX_CLOUD_ADD_TIME_=3e4;VillageClouds.MIN_CLOUD_TOP_=25;VillageClouds.MAX_CLOUD_TOP_=330;VillageClouds.MAX_CLOUD_WIDTH_=200;VillageClouds.NUM_TYPES_OF_CLOUDS_=3;VillageClouds.MIN_NUMBER_OF_CLOUDS_=3;VillageClouds.MAX_NUMBER_OF_CLOUDS_=7;VillageClouds.prototype.start=function(){this.addClouds_()};VillageClouds.prototype.stop=function(){window.clearTimeout(this.cloudTimeout_);this.numClouds_=0;$("#clouds").empty()};VillageClouds.prototype.addClouds_=function(){var numClouds=Math.max(VillageClouds.MIN_NUMBER_OF_CLOUDS_,Math.ceil(Math.random()*VillageClouds.MAX_NUMBER_OF_CLOUDS_));var width=windowWidth();for(var i=0;i<numClouds;i++){this.addCloud_(Math.random()*width)}if(VillageUtils.TRANSITIONS_SUPPORTED){this.addCloudAtRandomInterval_()}};VillageClouds.prototype.addCloudAtRandomInterval_=function(){if(this.numClouds_<VillageClouds.MAX_NUM_OF_CLOUDS_){this.addCloud_()}var timeout=Math.max(VillageClouds.MIN_CLOUD_ADD_TIME_,Math.random()*VillageClouds.MAX_CLOUD_ADD_TIME_);this.cloudTimeout_=window.setTimeout(_.bind(this.addCloudAtRandomInterval_,this),timeout)};VillageClouds.prototype.addCloud_=function(opt_offset){var top=Math.random()*(VillageClouds.MAX_CLOUD_TOP_-VillageClouds.MIN_CLOUD_TOP_);var type=Math.ceil(Math.random()*VillageClouds.NUM_TYPES_OF_CLOUDS_);var width=windowWidth();var offset=opt_offset||width;var cloud=$("<div>").addClass("cloud cloud"+type).css({top:top,left:offset}).append("<div>");$("#clouds").append(cloud);this.numClouds_++;if(!VillageUtils.TRANSITIONS_SUPPORTED){return}cloud.addClass("cloud-fly");window.setTimeout(function(){cloud.css(VillageUtils.CSS_TRANSFORM,"translateX(-"+(width+VillageClouds.MAX_CLOUD_WIDTH_)+"px)")},1);var that=this;window.setTimeout(function(){cloud.remove();that.numClouds_--},VillageClouds.ANIMATION_TIME_)};function VillagePegman(el){this.container_=el;this.isPaused_=true;this.pegman_=this.container_.querySelector("#pegman")}VillagePegman.SKYDIVE_TIME_=25e3;VillagePegman.FREEFALL_TIME_=.305*VillagePegman.SKYDIVE_TIME_;VillagePegman.MIN_SKYDIVE_TIME_=6e4;VillagePegman.MAX_SKYDIVE_TIME_=12e4;VillagePegman.LAND_TIME_=15e3;VillagePegman.prototype.start=function(){this.isPaused_=false;this.skyDive_()};VillagePegman.prototype.pause=function(){this.isPaused_=true};VillagePegman.prototype.resume=function(){this.isPaused_=false;if(this.pegman_.classList.contains("landed")){this.schedulePegmanPickup_()}else{this.skyDive_()}};VillagePegman.prototype.stop=function(){window.clearTimeout(this.pickupPegmanTimeoutID_)};VillagePegman.prototype.skyDive_=function(){if(this.isPaused_)return;var pegman=this.pegman_;pegman.classList.switch("landed","dive");pegman.classList.add("diving");pegman.classList.remove("takeoff");window.setTimeout(function(){pegman.classList.switch("dive","chute")},VillagePegman.FREEFALL_TIME_);window.setTimeout(function(){pegman.classList.switch("chute","landed");pegman.classList.remove("diving")},VillagePegman.SKYDIVE_TIME_);this.schedulePegmanPickup_()};VillagePegman.prototype.schedulePegmanPickup_=function(){if(this.isPaused_)return;window.clearTimeout(this.pickupPegmanTimeoutID_);var pickupTime=VillagePegman.MIN_SKYDIVE_TIME_+Math.random()*VillagePegman.MAX_SKYDIVE_TIME_;this.pickupPegmanTimeoutID_=window.setTimeout(this.pickupPegman_.bind(this),pickupTime)};VillagePegman.prototype.pickupPegman_=function(){if(this.isPaused_)return;var pegman=this.pegman_;var spaceship=this.container_.querySelector("#spaceship");spaceship.classList.add("to-space");var pegmanSpaceship=this.container_.querySelector("#pegman-spaceship");pegmanSpaceship.classList.add("land");var t=VillagePegman.LAND_TIME_+200;window.setTimeout(function(){pegman.classList.add("takeoff")},t);t+=200;window.setTimeout(function(){pegmanSpaceship.classList.remove("land")},t);t+=VillagePegman.LAND_TIME_;window.setTimeout(function(){pegman.classList.remove("landed");spaceship.classList.remove("to-space")},t);t+=5e3;window.setTimeout(this.skyDive_.bind(this),t)};function Animator(){this.animations_=[];this.updateFunction_=this.update_.bind(this);this.updateScheduled_=false}Animator.pageHiddenProp_=function(){var hiddenProp=Modernizr.prefixed("hidden",document,false);if(hiddenProp){return hiddenProp}}();Animator.isPageVisible=function(){return Animator.pageHiddenProp_?!document[Animator.pageHiddenProp_]:true};Animator.prototype.animate=function(update,duration,opt_easing){var easing=opt_easing||Animator.EASE_IN_OUT;var start=Animator.now_();var animation=new Animation(this,update,duration,easing,start);for(var i=0;this.animations_[i];i++){}this.animations_[i]=animation;this.scheduleUpdate_();return animation};Animator.prototype.update_=function(){this.updateScheduled_=false;var needUpdate=false;var now=Animator.now_();for(var i=0;i<this.animations_.length;i++){if(!this.animations_[i]){continue}if(now<this.animations_[i].start_){needUpdate=true;continue}var animation=this.animations_[i];var elapsed=now-animation.start_;var t=Math.max(0,Math.min(elapsed/animation.duration_,1));var eased=animation.easing_(t);animation.update_(eased);if(t===1){this.animations_[i]=null}else{needUpdate=true}}if(needUpdate){this.scheduleUpdate_()}};Animator.prototype.scheduleUpdate_=function(){if(this.updateScheduled_)return;this.updateScheduled_=true;Animator.requestAnimationFrame_(this.updateFunction_)};Animator.prototype.cancelAnimation_=function(animation){for(var i=0;i<this.animations_.length;i++){if(this.animations_[i]===animation){this.animations_[i]=null;return}}};Animator.requestAnimationFrame_=function(){var raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(raf){return function(callback){raf.call(window,callback)}}else{return function(callback){return window.setTimeout(callback,1e3/60)}}}();Animator.now_=function(){if(window.performance&&window.performance.now&&window.performance.now.bind){return window.performance.now.bind(window.performance)}else if(Date.now){return Date.now}else{return function now(){return+new Date}}}();Animator.EASE_IN_OUT=function(t){return t*t*t*(t*(t*6-15)+10)};function Animation(animator,update,duration,easing,start){this.animator_=animator;this.update_=update;this.duration_=duration;this.easing_=easing;this.start_=start}Animation.prototype.cancel=function(){this.animator_.cancelAnimation_(this)};(function(){var KEY_IDENTIFIER={"U+0009":"tab","U+001B":"esc","U+0020":"space","U+002A":"*","U+0030":"0","U+0031":"1","U+0032":"2","U+0033":"3","U+0034":"4","U+0035":"5","U+0036":"6","U+0037":"7","U+0038":"8","U+0039":"9","U+0041":"a","U+0042":"b","U+0043":"c","U+0044":"d","U+0045":"e","U+0046":"f","U+0047":"g","U+0048":"h","U+0049":"i","U+004A":"j","U+004B":"k","U+004C":"l","U+004D":"m","U+004E":"n","U+004F":"o","U+0050":"p","U+0051":"q","U+0052":"r","U+0053":"s","U+0054":"t","U+0055":"u","U+0056":"v","U+0057":"w","U+0058":"x","U+0059":"y","U+005A":"z","U+007F":"del"};var KEY_CODE={9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"};var KEY_CHAR=/[a-z0-9*]/;function transformKey(key){var validKey="";if(key){var lKey=key.toLowerCase();if(lKey.length==1){if(KEY_CHAR.test(lKey)){validKey=lKey}}else if(lKey=="multiply"){validKey="*"}else{validKey=lKey}}return validKey}var IDENT_CHAR=/U\+/;function transformKeyIdentifier(keyIdent){var validKey="";if(keyIdent){if(IDENT_CHAR.test(keyIdent)){validKey=KEY_IDENTIFIER[keyIdent]}else{validKey=keyIdent.toLowerCase()}}return validKey}function transformKeyCode(keyCode){var validKey="";if(Number(keyCode)){if(keyCode>=65&&keyCode<=90){validKey=String.fromCharCode(32+keyCode)}else if(keyCode>=112&&keyCode<=123){validKey="f"+(keyCode-112)}else if(keyCode>=48&&keyCode<=57){validKey=String(48-keyCode)}else if(keyCode>=96&&keyCode<=105){validKey=String(96-keyCode)}else{validKey=KEY_CODE[keyCode]}}return validKey}function keyboardEventToKey(ev){var normalizedKey=transformKey(ev.key)||transformKeyIdentifier(ev.keyIdentifier)||transformKeyCode(ev.keyCode)||"";return{shift:ev.shiftKey,ctrl:ev.ctrlKey,meta:ev.metaKey,alt:ev.altKey,key:normalizedKey}}function stringToKey(keyCombo){var keys=keyCombo.split("+");var keyObj=Object.create(null);keys.forEach(function(key){if(key=="shift"){keyObj.shift=true}else if(key=="ctrl"){keyObj.ctrl=true}else if(key=="alt"){keyObj.alt=true}else{keyObj.key=key}});return keyObj}function keyMatches(a,b){return Boolean(a.alt)==Boolean(b.alt)&&Boolean(a.ctrl)==Boolean(b.ctrl)&&Boolean(a.shift)==Boolean(b.shift)&&a.key===b.key}function processKeys(ev){var current=keyboardEventToKey(ev);for(var i=0,dk;i<this._desiredKeys.length;i++){dk=this._desiredKeys[i];if(keyMatches(dk,current)){ev.preventDefault();ev.stopPropagation();this.fire("keys-pressed",current,this,false);break}}}function listen(node,handler){if(node&&node.addEventListener){node.addEventListener("keydown",handler)}}function unlisten(node,handler){if(node&&node.removeEventListener){node.removeEventListener("keydown",handler)}}Polymer("core-a11y-keys",{created:function(){this._keyHandler=processKeys.bind(this)},attached:function(){if(!this.target){this.target=this.parentNode}listen(this.target,this._keyHandler)},detached:function(){unlisten(this.target,this._keyHandler)},publish:{keys:"",target:null},keysChanged:function(){var normalized=this.keys.replace("*","* shift+*");this._desiredKeys=normalized.toLowerCase().split(" ").map(stringToKey)},targetChanged:function(oldTarget){unlisten(oldTarget,this._keyHandler);listen(this.target,this._keyHandler)}})})();(function(){var TRANSITION_TIME_=300;Polymer("countdown-timer",{container:null,active:false,render:true,countDownEndDate:14194152e5,santaService:null,displayDigits:8,playSounds:false,publish:{finished:{value:false,reflect:true}},created:function(){this.titles=[];this.digits=[]},ready:function(){this.currentTime=this.getCurrentTime_();if(this.playSounds){this.audio=new AudioController}if(this.render){this.container=this.container||this}},attached:function(){if(this.render){this.titles=Array.prototype.slice.call(this.$.content.getDistributedNodes())}},domReady:function(){if(this.render){this.digits=Array.prototype.slice.call(this.$.counter.querySelectorAll(".digit"))}this.fire("countdown-timer-ready",this);this.tickTock()},countDownEndDateChanged:function(){this.countDownEndDate=parseInt(this.countDownEndDate)},pad:function(digit){return digit<10?"0"+digit:digit},getCurrentTime_:function(){var now=this.santaService?this.santaService.now():Date.now();var diff=Math.max(0,this.countDownEndDate-now);var msPerDay=24*60*60*1e3;var daysX=diff/msPerDay;var days=Math.floor(daysX);var hoursX=(daysX-days)*24;var hours=Math.floor(hoursX);var minsX=(hoursX-hours)*60;var mins=Math.floor(minsX);var secondsX=(minsX-mins)*60;var seconds=Math.floor(secondsX);return{diff:diff,days:days,hours:hours,mins:mins,seconds:seconds}},oldDigits:[],tickTock:function(){this.currentTime=this.getCurrentTime_();var days=this.currentTime.days;var hours=this.currentTime.hours;var mins=this.currentTime.mins;var seconds=this.currentTime.seconds;if(this.render){var newDigits=[this.pad(days),this.pad(hours),this.pad(mins),this.pad(seconds)].join("").split("");this.displayDigits=days==0?6:8;for(var i=0,digit;digit=this.digits[i];++i){this.setDigit(digit,this.oldDigits[i],newDigits[i])}this.oldDigits=newDigits}if(this.currentTime.diff==0){this.fire("countdown-timer-finish",this);this.finished=true;this.stop()}},setDigit:function(digit,oldVal,val){if(oldVal==val){return}var digitTopFront=digit.querySelector(".digit-top.digit-front");var digitBottomBehind=digit.querySelector(".digit-bottom.digit-behind");var digitTopBehind=digit.querySelector(".digit-top.digit-behind");var digitBottomFront=digit.querySelector(".digit-bottom.digit-front");digitTopBehind.firstElementChild.textContent=val;digitBottomFront.firstElementChild.textContent=val;if(oldVal===undefined){digitTopFront.firstElementChild.textContent=val;digitBottomBehind.firstElementChild.textContent=val;return}digit.classList.add("digit-anim");this.async(function(){digit.classList.remove("digit-anim");digitTopFront.firstElementChild.textContent=val;digitBottomBehind.firstElementChild.textContent=val},null,TRANSITION_TIME_*2)},stop:function(){window.clearInterval(this.tickInterval_);this.active=false},start:function(){if(this.active){return}this.active=true;this.tickTock();this.tickInterval_=window.setInterval(this.tickTock.bind(this),1e3)},setAudio:function(url,opt_callback){if(this.audio&&this.audio.isSupported){this.audio.load(url,opt_callback)}},playTick:function(){this.audio&&this.audio.play(.1)},isFinished:function(){return this.currentTime.diff<=0}})})();(function(){function polynomialEasing_(t){return t*t}Polymer("village-scene",{componentDir:"scenes/village/",updateScheduled_:false,villageWidth_:12740,parallaxLayers_:null,scrollContainer_:null,animator_:null,SCROLL_TIME_:5e3,scrollAnimation_:null,randomBusTimeoutID_:-1,timeOfDay:"day",created:function(){this.trees=[];this.treesBg=new Array(34);this.animator_=new Animator},ready:function(){this.super();this.container_=this.$["module-village"];this.scrollContainer_=this.$["village-parallax"];this.villageWidth_=parseFloat(getComputedStyle(this.$.village).width);this.addTrees_();if(!Modernizr.touch){this.scrollContainer_.addEventListener("scroll",this.scheduleParallaxUpdate_.bind(this));window.addEventListener("resize",this.scheduleParallaxUpdate_.bind(this))}var hour=(new Date).getHours();this.timeOfDay=6<=hour&&hour<=18?"day":"night";this.parallaxLayers_=Array.prototype.slice.call(this.container_.querySelectorAll(".parallax-layer"));this.scheduleParallaxUpdate_();this.villageSnow_=new VillageSnow(this.container_);this.villageBus_=new VillageBus(this.container_);this.villagePegman_=new VillagePegman(this.container_);this.villageSnowMobile_=new VillageSnowMobile(this.container_);if(navigator.userAgent.match(/iPhone|iPod|iPad/i)){this.$.spaceship.parentElement.removeChild(this.$.spaceship)}this.onMutation(this.$.houses,function(observer,records){this.async(function(){var todayEl=this.$.houses.querySelector(".today");if(todayEl){this.panToHouse(todayEl,0)}},null,350)})},domReady:function(){this.$.sun.classList.remove("go-down","go-up");this.$.moon.classList.remove("go-down","go-up")},modeChanged:function(){this.super();if(this.mode=="cast"){}},panToHouse:function(el,opt_time){var villageOffset=parseFloat(getComputedStyle(this.$.village).left);var left=parseFloat(getComputedStyle(el).left);var width=parseFloat(getComputedStyle(el.querySelector(".building")).width);this.panTo(left+width/2+villageOffset,opt_time||0)},onHouseClick:function(e,detail,sender){var iced=sender.templateInstance.model.house.iced;if(iced){e.preventDefault()}},onSnowManClick:function(e,detail,sender){this.$.snowman.classList.add("snowman-fall");this.playSound("village_snowman_click");this.fire("analytics-track-event",{category:"village",action:"click",label:"snowman"});this.async(function(){this.$.snowman.classList.remove("snowman-fall")},null,2e4)},onBalloonClick:function(e,detail,sender){if(sender.classList.contains("flying")){return}this.fire("analytics-track-event",{category:"village",action:"click",label:"balloon"});this.playSound("village_balloon_click");sender.classList.add("takeoff");this.$["balloon-ropes"].hidden=false;this.$["balloon-elf1"].hidden=true;this.$["balloon-elf2"].hidden=true;var WAIT=500;var timeout=1e3;this.async(function(){sender.classList.add("fly","flying","float")},null,timeout);var ANIMATION_TIME=55e3;timeout+=ANIMATION_TIME;this.async(function(){sender.classList.remove("flying","float")},null,timeout);timeout+=WAIT;this.async(function(){sender.classList.remove("takeoff");this.$["balloon-ropes"].hidden=true;this.$["balloon-elf1"].hidden=false;this.$["balloon-elf2"].hidden=false;this.playSound("village_balloon_landing")},null,timeout)},onSendBusToStop:function(e,detail,sender){var stopId=parseInt(sender.id.split("busstop")[1]);this.fire("analytics-track-event",{category:"village",action:"click",label:"busstop"+stopId});this.villageBus_.sendBusToStop(stopId)},onDriveSnowMobile:function(e,detail,sender){var snowMobileId=parseInt(sender.id.split("snowmobile")[1]);this.fire("analytics-track-event",{category:"village",action:"click",label:"snowmobile"+snowMobileId});this.villageSnowMobile_.driveSnowMobile(sender)},onFakeElementClick:function(e,detail,sender){if(sender.id=="fakesun"){this.fire("analytics-track-event",{category:"village",action:"click",label:"sun"});this.timeOfDay="night"}else if(sender.id=="fakemoon"){this.fire("analytics-track-event",{category:"village",action:"click",label:"moon"});this.timeOfDay="day"}},onHitArea:function(e,detail,sender){var left=sender==this.$["hit-area-right"]?this.villageWidth_:0;this.panTo(left,this.SCROLL_TIME_,polynomialEasing_)},addTrees_:function(){var numTrees=Math.max(3,Math.ceil(Math.random()*10));var width=parseFloat(getComputedStyle(this.$.trees).width);var left=0;var minDistanceBetweenTrees=2e3;var maxDistanceBetweenTrees=width/numTrees;var trees=[];for(var i=0;i<numTrees;i++){var pos=Math.max(minDistanceBetweenTrees,Math.random()*maxDistanceBetweenTrees);left+=pos;if(left>width){return}trees.push({left:left})}this.trees=trees},setPosition:function(value){value-=this.scrollContainer_.offsetWidth/2;this.scrollContainer_.scrollLeft=value},panTo:function(value,opt_duration,opt_easing){this.cancelScrollAnimation();var scrollee=this.scrollContainer_;var currentScroll=scrollee.scrollLeft;var targetScroll=value-scrollee.offsetWidth/2;var duration=opt_duration!=null?opt_duration:600;this.scrollAnimation_=this.animator_.animate(function(t){var scrollPos=currentScroll+t*(targetScroll-currentScroll);scrollee.scrollLeft=scrollPos},duration,opt_easing)},cancelScrollAnimation:function(e,detail,sender){if(this.scrollAnimation_){this.scrollAnimation_.cancel();this.scrollAnimation_=null}},scheduleParallaxUpdate_:function(){if(!this.active){return}if(!this.updateScheduled_){this.updateScheduled_=true;window.requestAnimationFrame(this.updateParallax_.bind(this))}},updateParallax_:function(){this.updateScheduled_=false;var scrollLeft=this.scrollContainer_.scrollLeft;var viewWidth=this.scrollContainer_.offsetWidth;var villageWidth=this.villageWidth_;for(var i=0,layer;layer=this.parallaxLayers_[i];i++){this.scrollLayer_(layer,scrollLeft,viewWidth,villageWidth)}},scrollLayer_:function(el,scrollLeft,viewWidth,refrenceWidth){var scrollScale=(el.offsetWidth-viewWidth)/(refrenceWidth-viewWidth);var translate=-scrollLeft*scrollScale;var translateStyle="translateX("+translate+"px)";el.style[VillageUtils.CSS_TRANSFORM]=translateStyle;el.style[VillageUtils.CSS_TRANSFORM]="translateZ(0) "+translateStyle},arrowHandler:function(e,detail,sender){var direction=0;if(detail.key==="up"||detail.key==="left"){direction=-1}else if(detail.key==="down"||detail.key==="right"){direction=1}else{return}this.job("arrowMarkerMove",function(){var activeElement=this.shadowRoot.activeElement?this.shadowRoot.activeElement:document.activeElement;var currentMarker;if(activeElement&&activeElement.classList.contains("house-marker")){currentMarker=activeElement}var markers=[].slice.call(this.$.houses.querySelectorAll('.house-marker[tabindex="0"]'));var newIndex=-1;if(currentMarker){var index=markers.indexOf(currentMarker);if(index!==-1&&markers[index+direction]){newIndex=index+direction}}else{var windowMiddle=window.innerWidth/2;var closestDistance=Number.MAX_VALUE;for(var i=0;i<markers.length;i++){var distance=Math.abs(markers[i].getBoundingClientRect().left-windowMiddle);if(distance<closestDistance){closestDistance=distance;newIndex=i}}}if(markers[newIndex]){markers[newIndex].focus()}})},onPreload:function(){this.preloadSounds("village_load_sounds");var images=["img/arrows_left.svg","img/arrows_right.svg","img/tree.svg","img/snow.svg","img/snow-flake.svg","img/elf-red-sit-right.svg","img/elf-green-sit-right.svg","img/elf-blue-sit-right.svg","img/elf-green-girl-sit-left.svg","img/elf-unicycle.svg","img/snowman_01.svg","img/snowman_02.svg","img/snowman_03.svg","img/snowman_04.svg","img/busstop.svg","img/bench.svg","img/chair.svg","img/snowmobile1.svg","img/snowmobile2.svg","img/snowmobile3.svg","img/bus.svg","img/bus-elf.svg","img/monorail.svg","img/train.svg","img/daymountains.svg","img/nightmountains.svg","img/plane.svg","img/spaceship.svg","img/sun.svg","img/moon.svg","img/balloon.svg","img/balloon-flight.svg","img/balloon-ropes.svg","img/pegman-land.svg","img/pegman-dive.svg","img/pegman-chute.svg","img/xmastree.svg","img/marker1-lock.svg","img/marker1_2-lock.svg","img/marker1_2-lock.svg","img/marker1_3-lock.svg","img/marker1_4-lock.svg"];for(var i=2;i<=23;i++){images.push("img/marker"+i+"-lock.svg")}for(var i=1;i<=9;i++){images.push("img/trees"+i+".svg")}var houses=["airport","racer","intro","app","selfie","boatload","briefing","matching","presentdrop","streetview","jamband","codelab","translations","video","mercator","controlroom","play","charity","jetpack","candy","postcard","traditions","windtunnel","gumball","citylights","santa"];for(var i=0,house;house=houses[i];i++){images.push("img/house-"+house+".svg");images.push("img/house-"+house+"-ice.svg")}this.preloadImages(images)},onShow:function(){this.santaApp.checkSchedule_();if(this.mode!="cast"){this.villageSnow_.start()}this.villageBus_.start();
this.villagePegman_.start();this.villageSnowMobile_.start();this.$.count.start();this.playAmbientSounds("village_start")},onHide:function(){window.clearTimeout(this.scheduleTimeout_);this.playAmbientSounds("village_end");if(this.mode!="cast"){this.villageSnow_.stop()}this.villageBus_.stop();this.villagePegman_.stop();this.villageSnowMobile_.stop();this.$.count.stop()},onPause:function(){this.playAmbientSounds("village_end");this.villageBus_.pause();this.villagePegman_.pause();this.villageSnowMobile_.stop();if(this.mode!="cast"){this.villageSnow_.stop()}},onResume:function(){this.villageBus_.resume();this.villagePegman_.resume();this.villageSnowMobile_.start();if(this.mode!="cast"){this.villageSnow_.start()}this.playAmbientSounds("village_start")}})})();